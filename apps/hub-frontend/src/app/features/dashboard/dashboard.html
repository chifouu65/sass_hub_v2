<div class="py-8 bg-gradient-to-br from-blue-50 to-indigo-100">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-8">
    <!-- Welcome Section -->
    <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
      <h2 class="text-3xl font-bold text-gray-900 mb-2">
        Bienvenue sur SaaS Hub !
      </h2>
      <p class="text-gray-600 mb-4">
        Gérez vos organisations et accédez à vos applications depuis un seul endroit.
      </p>
    </div>

    <!-- Quick Actions -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer">
        <div class="flex items-center mb-4">
          <div class="p-3 bg-indigo-100 rounded-lg">
            <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
            </svg>
          </div>
          <h3 class="ml-4 text-lg font-semibold text-gray-900">Organisations</h3>
        </div>
        <a routerLink="/organizations" class="text-gray-600">
          Créez et gérez vos organisations
        </a>
      </div>

      <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer">
        <div class="flex items-center mb-4">
          <div class="p-3 bg-green-100 rounded-lg">
            <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
          </div>
          <h3 class="ml-4 text-lg font-semibold text-gray-900">Applications</h3>
        </div>
        <p class="text-gray-600">
          Découvrez et activez des applications
        </p>
      </div>

      <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer">
        <div class="flex items-center mb-4">
          <div class="p-3 bg-purple-100 rounded-lg">
            <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
          </div>
          <h3 class="ml-4 text-lg font-semibold text-gray-900">Activité</h3>
        </div>
        <p class="text-gray-600">
          Suivez vos dernières actions
        </p>
      </div>
    </div>

    <!-- Getting Started -->
    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl shadow-lg p-8 text-white">
      <h3 class="text-2xl font-bold mb-4">Pour commencer</h3>
      <div class="space-y-3">
        <div class="flex items-start">
          <div class="flex-shrink-0">
            <svg class="w-6 h-6 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
          </div>
          <p class="ml-3">Créez votre première organisation</p>
        </div>
        <div class="flex items-start">
          <div class="flex-shrink-0">
            <svg class="w-6 h-6 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
          </div>
          <p class="ml-3">Activez des applications pour votre organisation</p>
        </div>
        <div class="flex items-start">
          <div class="flex-shrink-0">
            <svg class="w-6 h-6 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
          </div>
          <p class="ml-3">Invitez des membres à rejoindre votre organisation</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Organizations & Roles section -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
    <div class="bg-white rounded-2xl shadow-lg p-8">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
        <div>
          <h3 class="text-xl font-semibold text-gray-900">Vos organisations</h3>
          <p class="text-sm text-gray-600">
            Consultez les rôles disponibles et leurs permissions pour l'organisation sélectionnée.
          </p>
        </div>
        <div class="flex items-center gap-3">
          <button
            (click)="refreshOrganization()"
            class="inline-flex items-center px-4 py-2 text-sm font-medium text-indigo-600 bg-indigo-50 rounded-lg hover:bg-indigo-100 transition-colors"
            type="button"
          >
            Rafraîchir
          </button>
          @if (organizations().length > 0) {
            <select
              class="px-4 py-2 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none"
              [value]="selectedOrganizationId() ?? ''"
              (change)="onOrganizationChange($event)"
            >
              @for (organization of organizations(); track organization.id) {
                <option [value]="organization.id">{{ organization.name }}</option>
              }
            </select>
          }
        </div>
      </div>

      @if (error(); as message) {
        <div class="mb-6 rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700">
          {{ message }}
        </div>
      }

      @if (organizations().length === 0 && !loading()) {
        <div class="text-center text-gray-500 py-12 border border-dashed border-gray-200 rounded-xl">
          <p class="text-lg font-medium">Aucune organisation disponible pour le moment.</p>
          <p class="text-sm mt-2">Créez votre première organisation pour commencer à définir des rôles personnalisés.</p>
        </div>
      } @else {
        <div class="space-y-8">
          @if (loading()) {
            <div class="space-y-6">
              <div class="space-y-3">
                <app-skeleton height="1.5rem" width="35%"></app-skeleton>
                <app-skeleton height="0.9rem" width="55%"></app-skeleton>
              </div>
              <div class="rounded-xl border border-gray-100 bg-white">
                <div class="border-b border-gray-100 px-4 py-3">
                  <app-skeleton height="1rem" width="25%"></app-skeleton>
                </div>
                <div class="p-4 space-y-3">
                  @for (_ of roleSkeletonLines; track $index) {
                    <app-skeleton height="0.85rem" width="100%"></app-skeleton>
                  }
                </div>
              </div>
              <div class="overflow-hidden rounded-xl border border-gray-100">
                <table class="min-w-full">
                  <tbody class="bg-white divide-y divide-gray-100">
                    @for (_ of roleSkeletonRows; track $index) {
                      <tr>
                        <td class="px-4 py-4">
                          <div class="space-y-2">
                            <app-skeleton height="1rem" width="45%"></app-skeleton>
                            <app-skeleton height="0.75rem" width="35%"></app-skeleton>
                          </div>
                        </td>
                        <td class="px-4 py-4">
                          <app-skeleton height="1.5rem" width="5rem" borderRadius="9999px"></app-skeleton>
                        </td>
                        <td class="px-4 py-4">
                          <div class="flex flex-wrap gap-2">
                            <app-skeleton height="1.25rem" width="4.5rem" borderRadius="9999px"></app-skeleton>
                            <app-skeleton height="1.25rem" width="5.5rem" borderRadius="9999px"></app-skeleton>
                          </div>
                        </td>
                        <td class="px-4 py-4">
                          <app-skeleton height="0.75rem" width="60%"></app-skeleton>
                        </td>
                        <td class="px-4 py-4 text-right">
                          <app-skeleton height="2rem" width="6rem"></app-skeleton>
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            </div>
          } @else {
            <div class="overflow-x-auto rounded-xl border border-gray-100">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                      Rôle
                    </th>
                    <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                      Type
                    </th>
                    <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                      Permissions
                    </th>
                    <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                      Dernière mise à jour
                    </th>
                    <th scope="col" class="px-4 py-3 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider">
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  @if (roles().length === 0) {
                    <tr>
                      <td colspan="5" class="px-4 py-6 text-center text-sm text-gray-500">
                        Aucun rôle défini pour cette organisation.
                      </td>
                    </tr>
                  } @else {
                    @for (role of roles(); track role.id) {
                      <tr class="@if (role.isSystem) { bg-indigo-50/50 }">
                        <td class="px-4 py-4 text-sm">
                          <div class="font-semibold text-gray-900">{{ role.name }}</div>
                          <div class="text-xs text-gray-500">slug: {{ role.slug }}</div>
                          @if (role.description) {
                            <div class="text-xs text-gray-600 mt-1">{{ role.description }}</div>
                          }
                        </td>
                        <td class="px-4 py-4 text-sm">
                          <span
                            class="inline-flex items-center rounded-full px-3 py-1 text-xs font-medium"
                            [class.bg-indigo-100]="role.isSystem"
                            [class.text-indigo-700]="role.isSystem"
                            [class.bg-emerald-100]="!role.isSystem"
                            [class.text-emerald-700]="!role.isSystem"
                          >
                            {{ role.isSystem ? 'Système' : 'Personnalisé' }}
                          </span>
                        </td>
                        <td class="px-4 py-4 text-sm text-gray-700">
                          @if (role.permissions.length > 0) {
                            <div class="flex flex-wrap gap-2">
                              @for (permission of role.permissions; track permission) {
                                <span class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-1 text-xs font-medium text-gray-700">
                                  {{ permission }}
                                </span>
                              }
                            </div>
                          } @else {
                            <span class="text-xs text-gray-400">Aucune permission associée</span>
                          }
                        </td>
                        <td class="px-4 py-4 text-sm text-gray-500">
                          {{ role.updatedAt | date: 'short' }}
                        </td>
                        <td class="px-4 py-4 text-sm text-right">
                          @if (role.isSystem) {
                            <span class="text-xs font-medium text-indigo-600">
                              Rôle système
                            </span>
                          } @else {
                            <button
                              type="button"
                              class="inline-flex items-center rounded-lg border border-red-200 px-3 py-1.5 text-xs font-semibold text-red-600 hover:bg-red-50 transition-colors disabled:opacity-50"
                              [disabled]="deleteInProgress() === role.id"
                              (click)="deleteRole(role)"
                            >
                              @if (deleteInProgress() === role.id) {
                                <svg class="mr-2 h-4 w-4 animate-spin" viewBox="0 0 24 24" fill="none">
                                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                                </svg>
                              }
                              Supprimer
                            </button>
                          }
                        </td>
                      </tr>
                    }
                  }
                </tbody>
              </table>
            </div>

            <div class="grid gap-6 lg:grid-cols-[minmax(0,1fr)_minmax(0,1.2fr)] items-start">
              <div class="rounded-xl border border-gray-100 bg-white p-6 shadow-sm">
                <div class="mb-4">
                  <h4 class="text-lg font-semibold text-gray-900">Créer un rôle personnalisé</h4>
                  <p class="text-sm text-gray-600">
                    Définissez un nouveau rôle pour votre organisation en sélectionnant les permissions adéquates.
                  </p>
                </div>

                @if (formMessage(); as message) {
                  <div
                    class="mb-4 rounded-lg px-4 py-3 text-sm"
                    [class.bg-green-50]="message.kind === 'success'"
                    [class.text-green-700]="message.kind === 'success'"
                    [class.border-green-200]="message.kind === 'success'"
                    [class.bg-red-50]="message.kind === 'error'"
                    [class.text-red-700]="message.kind === 'error'"
                    [class.border-red-200]="message.kind === 'error'"
                  >
                    {{ message.text }}
                  </div>
                }

                <form class="space-y-5" [formGroup]="createRoleForm" (ngSubmit)="onCreateRole()">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1" for="role-name">Nom du rôle</label>
                    <input
                      id="role-name"
                      type="text"
                      formControlName="name"
                      (input)="onNameInput()"
                      class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200"
                      placeholder="Ex. Gestionnaire métier"
                    />
                    @if (createRoleForm.controls.name.invalid && createRoleForm.controls.name.touched) {
                      <p class="mt-1 text-xs text-red-600">
                        Le nom est requis (2 caractères minimum).
                      </p>
                    }
                  </div>

                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1" for="role-slug">Slug</label>
                    <input
                      id="role-slug"
                      type="text"
                      formControlName="slug"
                      (input)="onSlugInput()"
                      (blur)="onSlugBlur()"
                      class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200 uppercase:lowercase"
                      placeholder="ex. gestionnaire-metier"
                    />
                    <p class="mt-1 text-xs text-gray-500">
                      Le slug doit contenir uniquement des lettres minuscules, chiffres et tirets.
                    </p>
                    @if (createRoleForm.controls.slug.invalid && createRoleForm.controls.slug.touched) {
                      <p class="mt-1 text-xs text-red-600">
                        Slug invalide. Exemple: gestion-apps
                      </p>
                    }
                  </div>

                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1" for="role-description">Description</label>
                    <textarea
                      id="role-description"
                      formControlName="description"
                      rows="3"
                      class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200 resize-none"
                      placeholder="Décrivez brièvement le rôle (facultatif)"
                    ></textarea>
                  </div>

                  <div>
                    <div class="flex items-center justify-between mb-2">
                      <label class="text-sm font-medium text-gray-700">
                        Permissions associées
                      </label>
                      <span class="text-xs text-gray-500">
                        {{ permissionsControl.value.length }} sélectionnée{{ permissionsControl.value.length > 1 ? 's' : '' }}
                      </span>
                    </div>

                    @if (permissions().length === 0) {
                      <div class="rounded-lg border border-dashed border-gray-300 p-4 text-sm text-gray-500">
                        Aucune permission n'est disponible pour le moment. Contactez un administrateur système.
                      </div>
                    } @else {
                      <div class="max-h-56 overflow-y-auto rounded-lg border border-gray-200 bg-gray-50 px-3 py-3">
                        <div class="flex flex-col gap-2">
                          @for (permission of permissions(); track permission.id) {
                            <label
                              class="flex items-start gap-3 rounded-lg bg-white px-3 py-2 shadow-sm border border-gray-100 hover:border-indigo-200 transition-colors"
                            >
                              <input
                                type="checkbox"
                                class="mt-1 h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"
                                [checked]="isPermissionSelected(permission.code)"
                                (change)="togglePermission(permission.code, $event.target.checked)"
                              />
                              <span class="text-sm">
                                <span class="font-semibold text-gray-900">{{ permission.name }}</span>
                                <span class="block text-xs text-gray-500 uppercase tracking-wide mt-0.5">{{ permission.code }}</span>
                                @if (permission.description) {
                                  <span class="block text-xs text-gray-500 mt-1">{{ permission.description }}</span>
                                }
                              </span>
                            </label>
                          }
                        </div>
                      </div>
                    }
                  </div>

                  <div class="flex justify-end">
                    <button
                      type="submit"
                      class="inline-flex items-center rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 transition-colors disabled:opacity-60"
                      [disabled]="createSubmitting() || createRoleForm.invalid || !selectedOrganizationId()"
                    >
                      @if (createSubmitting()) {
                        <svg class="mr-2 h-4 w-4 animate-spin" viewBox="0 0 24 24" fill="none">
                          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                        </svg>
                      }
                      Créer le rôle
                    </button>
                  </div>
                </form>
              </div>

              <div class="border border-gray-100 rounded-xl p-6 bg-gray-50">
                <h4 class="text-sm font-semibold text-gray-900 uppercase tracking-wide mb-3">Permissions disponibles</h4>
                @if (permissions().length === 0) {
                  <p class="text-sm text-gray-500">
                    Aucune permission n'est disponible pour le moment.
                  </p>
                } @else {
                  <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4">
                    @for (permission of permissions(); track permission.id) {
                      <div class="rounded-lg bg-white p-4 shadow-sm border border-gray-100">
                        <p class="text-xs font-semibold text-indigo-600 uppercase tracking-wide mb-1">
                          {{ permission.code }}
                        </p>
                        <p class="text-sm font-medium text-gray-900">{{ permission.name }}</p>
                        @if (permission.description) {
                          <p class="text-xs text-gray-500 mt-2">{{ permission.description }}</p>
                        }
                      </div>
                    }
                  </div>
                }
              </div>
            </div>
          }
        </div>
      }
    </div>
  </section>
</div>
